FROM mcr.microsoft.com/playwright:v1.57.0-jammy

WORKDIR /app

# 1. Install Stockfish (From your local file)
COPY stockfish /usr/local/bin/stockfish
RUN chmod +x /usr/local/bin/stockfish

# 2. Install Dependencies
COPY package.json package-lock.json* ./
RUN npm ci

# 3. Copy Source Code
COPY . .

# 4. Build App
ENV NEXT_TELEMETRY_DISABLED=1
RUN npm run build

# 5. Run Tests
CMD ["npm", "run", "test:e2e"]
